<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Escala Ortopedia - responsivo e PDF</title>
<style>
  * {
    box-sizing: border-box;
  }
  body { font-family: sans-serif; padding: 12px; margin: 0; }
  h1 { text-align: center; margin-bottom: 8px; }
  .cabecalho { margin-bottom: 12px; }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    table-layout: fixed; /* força células a terem largura igual */
  }
  th, td {
    border: 1px solid #444;
    padding: 4px;
    min-width: 60px;
    text-align: center;
    word-wrap: break-word; /* quebra texto pra caber na célula */
  }
  .small { width: 25px; }
  input {
    width: 100%;
    border: none;
    background: transparent;
    font-size: 11px;
    padding: 2px;
    box-sizing: border-box;
  }
  #btnSalvarPDF {
    margin: 12px auto;
    display: block;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<h1>ESCALA ORTOPEDIA - LESTE</h1>

<button id="btnSalvarPDF">Salvar PDF</button>

<div class="cabecalho">
  <label>Data: <input type="date" id="data"></label>
</div>

<table id="tabela">
  <thead>
    <tr>
      <th>LEITO</th><th>NOME</th><th>DIAGNÓSTICO</th>
      <th>GLICEMIA</th><th>SUPLEMENTAÇÃO</th><th>GELO</th><th>FLUXO</th><th>BANHO</th>
      <th>DISPOSITIVOS</th><th>EXAMES</th><th>OUTROS</th><th>TÉCNICO</th>
    </tr>
  </thead>
  <tbody id="corpo-tabela"></tbody>
</table>

<div id="clone-container" style="position: fixed; top: -9999px; left: -9999px; opacity: 0; pointer-events: none;"></div>

<script>
  const leitos = [1176,1177,1178,1179,1180,1181,1182,1183,1184,1186,1188,1190,1191,1192,1193,1194,1195,1196,1197,1198];
  const corpo = document.getElementById("corpo-tabela");
  leitos.forEach((leito, idx) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${leito}</td><td><input data-id="l${idx}-nome"></td><td><input data-id="l${idx}-diag"></td>${
      [...Array(5)].map((_,i)=>`<td class="small"><input data-id="l${idx}-m${i}"></td>`).join("")
    }<td><input data-id="l${idx}-fluxo"></td><td><input data-id="l${idx}-exames"></td><td><input data-id="l${idx}-alta"></td><td><input data-id="l${idx}-técnico"></td>`;
    corpo.appendChild(tr);
  });

  window.onload = () => {
    document.querySelectorAll("input[data-id]").forEach(inp => {
      inp.value = localStorage.getItem(inp.getAttribute("data-id")) || "";
      inp.oninput = () => localStorage.setItem(inp.getAttribute("data-id"), inp.value);
    });
    const dataInput = document.getElementById("data");
    if(dataInput){
      dataInput.value = localStorage.getItem("data") || "";
      dataInput.oninput = () => localStorage.setItem("data", dataInput.value);
    }
  };

  const { jsPDF } = window.jspdf;

  document.getElementById("btnSalvarPDF").addEventListener("click", () => {
    const tabela = document.getElementById("tabela");
    const cloneContainer = document.getElementById("clone-container");

    cloneContainer.innerHTML = "";
    const tabelaClone = tabela.cloneNode(true);

    // Trocar inputs por texto no clone
    tabelaClone.querySelectorAll("input").forEach(input => {
      const td = input.parentElement;
      td.textContent = input.value || "";
    });

    cloneContainer.appendChild(tabelaClone);

    html2canvas(tabelaClone, {scale: 2}).then(canvas => {
      const imgData = canvas.toDataURL("image/png");
      const pdf = new jsPDF('l', 'pt', 'a4');
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const pdfHeight = pdf.internal.pageSize.getHeight();

      const imgWidth = canvas.width;
      const imgHeight = canvas.height;
      const scale = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);

      const imgScaledWidth = imgWidth * scale;
      const imgScaledHeight = imgHeight * scale;

      const x = (pdfWidth - imgScaledWidth) / 2;
      const y = (pdfHeight - imgScaledHeight) / 2;

      pdf.addImage(imgData, 'PNG', x, y, imgScaledWidth, imgScaledHeight);
      pdf.save("escala_ortopedia.pdf");
    }).catch(err => {
      alert("Erro ao gerar PDF: " + err);
    });
  });
</script>

</body>
</html>


